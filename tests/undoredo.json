{
    "type": "cmd",
    "tests": [
        {
            "name": "t/undoredo",
            "file": "malloc://1024",
            "args": "",
            "commands": [
                "",
                "?e No seeks.",
                "s* ; ?v $$",
                "?e",
                "",
                "?e But try undo/redo.",
                "s-",
                "s+",
                "s*",
                "s+",
                "s+",
                "s-",
                "s-",
                "s-",
                "s+",
                "s*",
                "?e",
                "",
                "?e First seeks.",
                "s 0x10 ; s* ; ?v $$",
                "s 0x20 ; s* ; ?v $$",
                "s 0x30 ; s* ; ?v $$",
                "s 0x40 ; s* ; ?v $$",
                "?e",
                "",
                "?e Undo all seeks (and some more).",
                "s- ; s* ; ?v $$ ; ?e",
                "s- ; s* ; ?v $$ ; ?e",
                "s- ; s* ; ?v $$ ; ?e",
                "s- ; s* ; ?v $$ ; ?e",
                "# Test if more undos break something.",
                "s- ; s* ; ?v $$ ; ?e",
                "s- ; s* ; ?v $$ ; ?e",
                "",
                "?e Then redo them (and some more).",
                "s+ ; s* ; ?v $$ ; ?e",
                "s+ ; s* ; ?v $$ ; ?e",
                "s+ ; s* ; ?v $$ ; ?e",
                "s+ ; s* ; ?v $$ ; ?e",
                "# Test if more undos break something.",
                "s+ ; s* ; ?v $$ ; ?e",
                "s+ ; s* ; ?v $$ ; ?e",
                "",
                "?e Undo some seeks and then seek somewhere else.",
                "s- ; s-",
                "s* ; ?v $$ ; ?e",
                "s 0x50",
                "s* ; ?v $$ ; ?e",
                "# Redo now does nothing.",
                "s+ ; s+ ; s+",
                "s* ; ?v $$ ; ?e",
                "",
                "?e Undo all seeks again and perform a single seek with undo/redo.",
                "s- ; s- ; s-",
                "s* ; ?v $$ ; ?e",
                "s 0x100",
                "s* ; ?v $$ ; ?e",
                "s- ; s+",
                "s* ; ?v $$ ; ?e",
                "",
                ""
            ],
            "expected": "No seeks.\n0x0\n\nBut try undo/redo.\n\nFirst seeks.\nf undo_0 @ 0x0\n0x10\nf undo_1 @ 0x0\nf undo_0 @ 0x10\n0x20\nf undo_2 @ 0x0\nf undo_1 @ 0x10\nf undo_0 @ 0x20\n0x30\nf undo_3 @ 0x0\nf undo_2 @ 0x10\nf undo_1 @ 0x20\nf undo_0 @ 0x30\n0x40\n\nUndo all seeks (and some more).\nf undo_2 @ 0x0\nf undo_1 @ 0x10\nf undo_0 @ 0x20\n# Current undo/redo position.\nf redo_0 @ 0x40\n0x30\n\nf undo_1 @ 0x0\nf undo_0 @ 0x10\n# Current undo/redo position.\nf redo_0 @ 0x30\nf redo_1 @ 0x40\n0x20\n\nf undo_0 @ 0x0\n# Current undo/redo position.\nf redo_0 @ 0x20\nf redo_1 @ 0x30\nf redo_2 @ 0x40\n0x10\n\nf redo_0 @ 0x10\nf redo_1 @ 0x20\nf redo_2 @ 0x30\nf redo_3 @ 0x40\n0x0\n\nf redo_0 @ 0x10\nf redo_1 @ 0x20\nf redo_2 @ 0x30\nf redo_3 @ 0x40\n0x0\n\nf redo_0 @ 0x10\nf redo_1 @ 0x20\nf redo_2 @ 0x30\nf redo_3 @ 0x40\n0x0\n\nThen redo them (and some more).\nf undo_0 @ 0x0\n# Current undo/redo position.\nf redo_0 @ 0x20\nf redo_1 @ 0x30\nf redo_2 @ 0x40\n0x10\n\nf undo_1 @ 0x0\nf undo_0 @ 0x10\n# Current undo/redo position.\nf redo_0 @ 0x30\nf redo_1 @ 0x40\n0x20\n\nf undo_2 @ 0x0\nf undo_1 @ 0x10\nf undo_0 @ 0x20\n# Current undo/redo position.\nf redo_0 @ 0x40\n0x30\n\nf undo_3 @ 0x0\nf undo_2 @ 0x10\nf undo_1 @ 0x20\nf undo_0 @ 0x30\n0x40\n\nf undo_3 @ 0x0\nf undo_2 @ 0x10\nf undo_1 @ 0x20\nf undo_0 @ 0x30\n0x40\n\nf undo_3 @ 0x0\nf undo_2 @ 0x10\nf undo_1 @ 0x20\nf undo_0 @ 0x30\n0x40\n\nUndo some seeks and then seek somewhere else.\nf undo_1 @ 0x0\nf undo_0 @ 0x10\n# Current undo/redo position.\nf redo_0 @ 0x30\nf redo_1 @ 0x40\n0x20\n\nf undo_2 @ 0x0\nf undo_1 @ 0x10\nf undo_0 @ 0x20\n0x50\n\nf undo_2 @ 0x0\nf undo_1 @ 0x10\nf undo_0 @ 0x20\n0x50\n\nUndo all seeks again and perform a single seek with undo/redo.\nf redo_0 @ 0x10\nf redo_1 @ 0x20\nf redo_2 @ 0x50\n0x0\n\nf undo_0 @ 0x0\n0x100\n\nf undo_0 @ 0x0\n0x100\n\n\n",
            "broken": false
        }
    ]
}